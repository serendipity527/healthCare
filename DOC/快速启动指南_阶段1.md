# HealthCare AI 对话功能 - 快速启动指南 (阶段 1)

## 🚀 5 分钟快速启动

### 步骤 1：配置 AI 服务

**当前配置**：项目已配置阿里云通义千问（qwen-flash），可直接使用！

查看配置文件 `src/main/resources/application.yml`：
```yaml
langchain4j:
  open-ai:
    chat-model:
      api-key: sk-43070f4cd1074965a93a03d6d5333cd8
      base-url: https://dashscope.aliyuncs.com/compatible-mode/v1
      model-name: qwen-flash
```

> 💡 **使用其他 AI 服务**：参考 `DOC/application.yml配置说明.md` 切换到 OpenAI 或其他服务

### 步骤 2：启动应用

**方式一：使用 Maven**（如果 Maven 在系统路径中）
```bash
mvn spring-boot:run
```

**方式二：使用 IDE**
1. 在 IntelliJ IDEA 中打开项目
2. 找到 `HealthCareApplication.java`
3. 右键 → Run 'HealthCareApplication'

**方式三：使用已编译的 JAR**
```bash
java -jar target/healthCare-0.0.1-SNAPSHOT.jar
```

### 步骤 3：验证启动成功

查看控制台输出，确认以下信息：
```
✅ Started HealthCareApplication in X.XXX seconds
✅ Tomcat started on port(s): 8080
✅ LangChain4j initialized successfully
✅ WebSocket configuration loaded
```

### 步骤 4：打开测试页面

使用浏览器打开：
```
file:///D:/Project/IdeaProject/healthCare/Front/ai-chat.html
```

或直接双击 `Front/ai-chat.html` 文件

### 步骤 5：开始对话

1. **检查连接状态**：页面顶部应显示"已连接"（绿色）
2. **发送第一条消息**：在输入框输入 "你好"，点击发送
3. **查看 AI 回复**：等待几秒，AI 会返回回复

## 🧪 测试用例

### 测试 1：基础对话
```
用户: 你好
预期: AI 友好回复，介绍自己的功能
```

### 测试 2：医疗咨询
```
用户: 我最近有点头疼，怎么办？
预期: AI 询问更多症状细节，给出初步建议
```

### 测试 3：多轮对话
```
用户: 我想咨询一下感冒的问题
AI: (回复)
用户: 我已经咳嗽三天了
预期: AI 能记住上下文，结合之前的对话回复
```

### 测试 4：会话管理
```
1. 点击"新会话"按钮
2. 发送新消息
预期: AI 不记得之前的对话内容（新会话）
```

### 测试 5：清空对话
```
1. 点击"清空对话"按钮
预期: 对话界面清空，但会话ID不变
```

## 📊 功能验证清单

- [ ] WebSocket 连接成功（状态显示"已连接"）
- [ ] 发送消息后显示"正在思考..."状态
- [ ] AI 回复显示正常
- [ ] 多轮对话上下文连贯
- [ ] 新会话功能正常
- [ ] 清空对话功能正常
- [ ] 会话ID和用户ID显示正确

## ❌ 常见问题

### Q1: 页面显示"未连接"
**可能原因**:
- 应用未启动
- 端口被占用
- WebSocket 配置问题

**解决方法**:
1. 检查应用是否正常启动
2. 查看控制台是否有错误信息
3. 确认端口 8080 没有被占用
4. 检查浏览器控制台 (F12) 的错误信息

### Q2: 点击发送按钮没反应
**可能原因**:
- WebSocket 未连接
- 输入框为空

**解决方法**:
1. 确保连接状态为"已连接"
2. 输入框必须有内容
3. 刷新页面重新连接

### Q3: AI 一直显示"正在思考..."
**可能原因**:
- API Key 未配置或无效
- 网络问题
- API 额度用尽或服务不可用

**解决方法**:
1. 检查 `application.yml` 中的 API Key 是否正确
2. 查看应用控制台的错误日志
3. 验证 API 服务可用性（访问服务商官网）
4. 检查网络连接和代理设置

### Q4: AI 回复"抱歉，我遇到了一些技术问题"
**可能原因**:
- AI API 调用失败
- API Key 无效或过期
- 网络超时

**解决方法**:
1. 查看应用日志中的详细错误
2. 验证 `application.yml` 中的 API Key 和 base-url
3. 检查网络连接和防火墙设置
4. 尝试增加超时时间（修改 `application.yml` 中的 `timeout`）

### Q5: 应用启动失败
**可能原因**:
- 端口 8080 被占用
- JDK 版本不匹配
- 依赖下载失败

**解决方法**:
1. 修改端口（application.properties 添加 `server.port=8081`）
2. 确保使用 JDK 17+
3. 运行 `mvn clean install` 重新下载依赖

## 🔧 调试技巧

### 查看日志
**应用日志**：控制台输出
**前端日志**：浏览器控制台 (F12 → Console)

### 启用详细日志
在 `application.yml` 中已默认启用：
```yaml
logging:
  level:
    com.yihu.agent: DEBUG
    dev.langchain4j: DEBUG
```

### 测试 WebSocket 连接
在浏览器控制台执行：
```javascript
console.log('Connection status:', stompClient ? stompClient.connected : 'Not initialized');
```

### 查看会话信息
检查页面底部的用户ID和会话ID是否正确显示

## 📱 浏览器兼容性

推荐使用以下浏览器测试：
- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+

## 🎯 下一步

测试通过后，可以：
1. 尝试更复杂的医疗咨询对话
2. 测试长时间对话（验证会话保持）
3. 测试多个浏览器标签（验证会话隔离）
4. 准备进入阶段 2 开发

## 📞 获取帮助

如遇到问题：
1. 查看 `DOC/实施进度/阶段1_MVP基础链路_完成报告.md`
2. 查看 `DOC/application.yml配置说明.md`
3. 查看 `DOC/AI环境配置指南.md`
4. 检查应用和浏览器控制台的错误日志

---

**祝测试顺利！** 🎉

