# æ™ºèƒ½åŒ»ç–—åŠ©æ‰‹ Agent - ç®€åŒ–ç‰ˆè®¾è®¡æ–‡æ¡£

> åŸºäº **LangChain4j + WebSocket** çš„ MVP æ¶æ„æ–¹æ¡ˆï¼ˆä¸ä½¿ç”¨ LangGraph4jï¼‰

## ğŸ—ï¸ é¡¹ç›®æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚ (Frontend)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue 3 / React / åŸç”Ÿ HTML + JS                                 â”‚
â”‚  â””â”€ WebSocket Client (å®æ—¶å¯¹è¯)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ WebSocket è¿æ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WebSocket ç½‘å…³å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebSocketHandler                                               â”‚
â”‚  â”œâ”€ æ¶ˆæ¯è·¯ç”±                                                     â”‚
â”‚  â”œâ”€ ä¼šè¯ç®¡ç† (SessionManager)                                   â”‚
â”‚  â””â”€ æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ–                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ ¸å¿ƒä¸šåŠ¡å±‚ (Core Service)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         ç®€å•çŠ¶æ€ç®¡ç†å™¨ (State Manager)                â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  çŠ¶æ€æµç¨‹ï¼š                                            â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  [ç”¨æˆ·æ¶ˆæ¯]                                           â”‚     â”‚
â”‚  â”‚      â†“                                                â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚     â”‚
â”‚  â”‚  â”‚  çŠ¶æ€åˆ¤æ–­é€»è¾‘ (SessionState)         â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  - GREETING: æ¬¢è¿é˜¶æ®µ                â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  - COLLECTING: ä¿¡æ¯æ”¶é›†ä¸­            â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  - ANALYZING: åˆ†æä¿¡æ¯å®Œæ•´åº¦         â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  - RECOMMENDING: ç”Ÿæˆæ¨è            â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  - COMPLETED: å®Œæˆ                   â”‚            â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â”‚      â†“                                                â”‚     â”‚
â”‚  â”‚  æ ¹æ®çŠ¶æ€è°ƒç”¨å¯¹åº”çš„å¤„ç†å™¨ (Handler)                   â”‚     â”‚
â”‚  â”‚      â†“                                                â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚     â”‚
â”‚  â”‚  â”‚  GreetingHandler                     â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  CollectingHandler (ä¸»è¦)            â”‚            â”‚     â”‚
â”‚  â”‚  â”‚  RecommendHandler                    â”‚            â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â”‚      â†“                                                â”‚     â”‚
â”‚  â”‚  è¿”å›å“åº” + æ›´æ–°çŠ¶æ€                                   â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                             â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚          LangChain4j AI Service å±‚                   â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  â€¢ ChatLanguageModel (å¯¹è¯æ¨¡å‹)                      â”‚       â”‚
â”‚  â”‚  â€¢ AiServices (AI æœåŠ¡æ¥å£)                          â”‚       â”‚
â”‚  â”‚  â€¢ ChatMemory (å¯¹è¯è®°å¿† - MessageWindowChatMemory)   â”‚       â”‚
â”‚  â”‚  â€¢ PromptTemplate (æç¤ºè¯æ¨¡æ¿)                       â”‚       â”‚
â”‚  â”‚  â€¢ @Tool æ–¹æ³• (å·¥å…·å‡½æ•°è°ƒç”¨)                         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®è®¿é—®å±‚ (Data Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ConcurrentMap   â”‚  â”‚ JSON Files      â”‚  â”‚ Redis (å¯é€‰)    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ ä¼šè¯çŠ¶æ€      â”‚  â”‚ â€¢ åŒ»ç”Ÿæ•°æ®      â”‚  â”‚ â€¢ ä¼šè¯æŒä¹…åŒ–    â”‚  â”‚
â”‚  â”‚ â€¢ å¯¹è¯å†å²      â”‚  â”‚ â€¢ è¯ç‰©çŸ¥è¯†åº“    â”‚  â”‚ â€¢ åˆ†å¸ƒå¼ç¼“å­˜    â”‚  â”‚
â”‚  â”‚ â€¢ æ”¶é›†çš„ä¿¡æ¯    â”‚  â”‚ â€¢ ç–¾ç—…æ˜ å°„      â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚ (å†…å­˜çº§åˆ«)      â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡å±‚ (External)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ OpenAI API       â”‚  â”‚ é€šä¹‰åƒé—® API      â”‚  (é€‰æ‹©ä¸€ä¸ª)         â”‚
â”‚  â”‚ GPT-4 / GPT-3.5  â”‚  â”‚ æˆ–å…¶ä»–å›½äº§ LLM    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å®ç°æ€è·¯

### **1ï¸âƒ£ ç®€åŒ–çš„çŠ¶æ€ç®¡ç†è®¾è®¡**

**ä¸ä½¿ç”¨å¤æ‚çš„çŠ¶æ€æœºæ¡†æ¶ï¼Œä½¿ç”¨ç®€å•çš„çŠ¶æ€æ¨¡å¼ï¼š**

```java
// çŠ¶æ€æšä¸¾
public enum SessionState {
    GREETING,       // åˆå§‹æ¬¢è¿
    COLLECTING,     // ä¿¡æ¯æ”¶é›†ä¸­ï¼ˆæ ¸å¿ƒçŠ¶æ€ï¼‰
    ANALYZING,      // åˆ†æä¸­ï¼ˆå†…éƒ¨çŠ¶æ€ï¼Œç”¨æˆ·ä¸æ„ŸçŸ¥ï¼‰
    RECOMMENDING,   // æ¨èä¸­
    COMPLETED       // å®Œæˆ
}

// çŠ¶æ€å¤„ç†å™¨æ¥å£
public interface StateHandler {
    StateResponse handle(SessionContext context, String userMessage);
}

// æ ¸å¿ƒæµç¨‹
1. ç”¨æˆ·å‘é€æ¶ˆæ¯
2. StateManager æ ¹æ®å½“å‰çŠ¶æ€é€‰æ‹©å¯¹åº”çš„ Handler
3. Handler è°ƒç”¨ LangChain4j AI Service
4. AI Service æå–ä¿¡æ¯ / ç”Ÿæˆå›å¤ / è°ƒç”¨å·¥å…·
5. Handler æ›´æ–° SessionContextï¼ˆçŠ¶æ€ã€æ”¶é›†çš„ä¿¡æ¯ï¼‰
6. è¿”å›å“åº”ç»™ç”¨æˆ·
```

**çŠ¶æ€è½¬æ¢é€»è¾‘ï¼š**

```
GREETING â†’ COLLECTING
    è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·å¼€å§‹æè¿°ç—‡çŠ¶

COLLECTING â†’ COLLECTING
    è§¦å‘æ¡ä»¶ï¼šä¿¡æ¯ä¸å®Œæ•´ï¼Œç»§ç»­æ”¶é›†

COLLECTING â†’ RECOMMENDING
    è§¦å‘æ¡ä»¶ï¼šå¿…è¦ä¿¡æ¯æ”¶é›†å®Œæˆï¼ˆç”± AI åˆ¤æ–­ï¼‰

RECOMMENDING â†’ COMPLETED
    è§¦å‘æ¡ä»¶ï¼šæ¨èå®Œæˆ

COMPLETED â†’ COLLECTING
    è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·æœ‰æ–°çš„é—®é¢˜ï¼ˆé‡æ–°å¼€å§‹ï¼‰
```

### **2ï¸âƒ£ å¿…é¡»æ”¶é›†çš„ä¿¡æ¯å­—æ®µ**

```java
@Data
@Builder
public class PatientInfo {
    private String age;              // å¹´é¾„ âœ“ å¿…éœ€
    private String gender;           // æ€§åˆ« âœ“ å¿…éœ€
    private String mainSymptom;      // ä¸»è¦ç—‡çŠ¶ âœ“ å¿…éœ€
    private String duration;         // æŒç»­æ—¶é—´ âœ“ å¿…éœ€
    private String severity;         // ä¸¥é‡ç¨‹åº¦ï¼ˆè½»åº¦/ä¸­åº¦/é‡åº¦ï¼‰
    private String accompanySymptoms;// ä¼´éšç—‡çŠ¶
    private String medicalHistory;   // æ—¢å¾€ç—…å²
    private String allergies;        // è¿‡æ•å²
    private String location;         // ç—‡çŠ¶éƒ¨ä½
    
    // è®¡ç®—ä¿¡æ¯å®Œæ•´åº¦
    public int getCompleteness() {
        int score = 0;
        if (age != null) score += 25;
        if (gender != null) score += 25;
        if (mainSymptom != null) score += 30;
        if (duration != null) score += 20;
        return score;
    }
    
    public boolean isReadyForRecommendation() {
        return getCompleteness() >= 80;
    }
}
```

### **3ï¸âƒ£ LangChain4j AI Service è®¾è®¡**

ä½¿ç”¨ LangChain4j çš„ `AiServices` æ¥å£å®šä¹‰ AI åŠ©æ‰‹ï¼š

```java
public interface MedicalAssistant {
    
    // ä¿¡æ¯æå–å·¥å…·
    @SystemMessage("""
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŒ»ç–—ä¿¡æ¯æ”¶é›†åŠ©æ‰‹ã€‚
        ä»ç”¨æˆ·çš„æè¿°ä¸­æå–å…³é”®åŒ»ç–—ä¿¡æ¯ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€ç—‡çŠ¶ã€æŒç»­æ—¶é—´ç­‰ï¼‰ã€‚
        å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œç”Ÿæˆå‹å¥½çš„è¿½é—®ã€‚
        """)
    String collectInformation(String userMessage);
    
    // æ¨èåŒ»ç”Ÿ
    @SystemMessage("æ ¹æ®æ‚£è€…ä¿¡æ¯æ¨èåˆé€‚çš„åŒ»ç”Ÿå’Œç§‘å®¤")
    String recommendDoctor(
        @V("patientInfo") PatientInfo patientInfo,
        @V("doctors") List<Doctor> availableDoctors
    );
    
    // æ¨èè¯ç‰©
    @SystemMessage("""
        æ ¹æ®ç—‡çŠ¶æ¨èéå¤„æ–¹è¯ç‰©ã€‚
        å¿…é¡»åŒ…å«å…è´£å£°æ˜ï¼šæœ¬å»ºè®®ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­ã€‚
        """)
    String recommendMedicine(
        @V("patientInfo") PatientInfo patientInfo
    );
}
```

### **4ï¸âƒ£ LangChain4j Toolsï¼ˆå·¥å…·å‡½æ•°ï¼‰**

```java
public class MedicalTools {
    
    @Tool("ä»å¯¹è¯ä¸­æå–æ‚£è€…ä¿¡æ¯ï¼Œè¿”å› JSON æ ¼å¼")
    public String extractPatientInfo(String conversation) {
        // ä½¿ç”¨ AI ä»å¯¹è¯ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯
        // è¿”å› PatientInfo çš„ JSON
    }
    
    @Tool("æ£€æŸ¥ä¿¡æ¯å®Œæ•´åº¦ï¼Œè¿”å›ç¼ºå¤±çš„å­—æ®µ")
    public String checkCompleteness(PatientInfo info) {
        List<String> missing = new ArrayList<>();
        if (info.getAge() == null) missing.add("å¹´é¾„");
        if (info.getGender() == null) missing.add("æ€§åˆ«");
        if (info.getMainSymptom() == null) missing.add("ä¸»è¦ç—‡çŠ¶");
        if (info.getDuration() == null) missing.add("æŒç»­æ—¶é—´");
        return missing.isEmpty() ? "å®Œæ•´" : "ç¼ºå¤±ï¼š" + String.join("ã€", missing);
    }
    
    @Tool("æ ¹æ®ç—‡çŠ¶æ¨èç§‘å®¤")
    public String recommendDepartment(String symptom) {
        // ç—‡çŠ¶å…³é”®è¯æ˜ å°„åˆ°ç§‘å®¤
        Map<String, String> symptomDeptMap = Map.of(
            "å¤´ç—›", "ç¥ç»å†…ç§‘",
            "å‘çƒ§", "å†…ç§‘",
            "å’³å—½", "å‘¼å¸ç§‘",
            "èƒƒç—›", "æ¶ˆåŒ–å†…ç§‘",
            "çš®ç–¹", "çš®è‚¤ç§‘"
        );
        // ... å®é™…å®ç°ä¼šæ›´å¤æ‚
    }
    
    @Tool("æœç´¢åŒ»ç”Ÿ")
    public List<Doctor> searchDoctors(String department, String specialty) {
        // ä»æ•°æ®åº“æˆ– JSON æ–‡ä»¶ä¸­æŸ¥è¯¢åŒ»ç”Ÿ
    }
}
```

## ğŸ“‚ é¡¹ç›®ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰

```
healthCare/
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/yihu/agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ HealthCareApplication.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ config/                       # é…ç½®å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WebSocketConfig.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LangChainConfig.java      (é…ç½® ChatLanguageModel)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CorsConfig.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket/                    # WebSocket å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatWebSocketHandler.java (æ ¸å¿ƒ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SessionManager.java       (ç®¡ç† WebSocket ä¼šè¯)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ state/                        # çŠ¶æ€ç®¡ç†ï¼ˆæ›¿ä»£ LangGraphï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SessionState.java         (çŠ¶æ€æšä¸¾)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SessionContext.java       (ä¼šè¯ä¸Šä¸‹æ–‡)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StateManager.java         (çŠ¶æ€ç®¡ç†å™¨ - æ ¸å¿ƒ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ handlers/                 (çŠ¶æ€å¤„ç†å™¨)
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ StateHandler.java     (æ¥å£)
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ GreetingHandler.java
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ CollectingHandler.java (æ ¸å¿ƒå¤„ç†å™¨)
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RecommendHandler.java
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ CompletedHandler.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                      # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MedicalAssistantService.java  (LangChain4j AiService)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InfoExtractionService.java    (ä¿¡æ¯æå–)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RecommendationService.java    (æ¨èå¼•æ“)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ChatMemoryService.java        (å¯¹è¯è®°å¿†ç®¡ç†)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/                        # LangChain4j Tools
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MedicalTools.java         (æ‰€æœ‰ @Tool æ–¹æ³•)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InfoChecker.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DoctorSearcher.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MedicineSearcher.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ model/                        # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PatientInfo.java      (æ ¸å¿ƒæ•°æ®æ¨¡å‹)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StateResponse.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RecommendationResult.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ entity/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Doctor.java
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Medicine.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/                   # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DoctorRepository.java     (è¯»å– JSON)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MedicineRepository.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SessionRepository.java    (å†…å­˜/Redis)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ constant/                     # å¸¸é‡
â”‚   â”‚   â”‚       â”œâ”€â”€ PromptConstants.java      (æç¤ºè¯å¸¸é‡)
â”‚   â”‚   â”‚       â””â”€â”€ StateConstants.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â”œâ”€â”€ prompts/                      # æç¤ºè¯æ¨¡æ¿
â”‚   â”‚       â”‚   â”œâ”€â”€ system-greeting.txt
â”‚   â”‚       â”‚   â”œâ”€â”€ info-collection.txt
â”‚   â”‚       â”‚   â”œâ”€â”€ info-extraction.txt
â”‚   â”‚       â”‚   â””â”€â”€ recommendation.txt
â”‚   â”‚       â””â”€â”€ data/                         # åˆå§‹æ•°æ®
â”‚   â”‚           â”œâ”€â”€ doctors.json
â”‚   â”‚           â”œâ”€â”€ medicines.json
â”‚   â”‚           â””â”€â”€ symptom-department-mapping.json
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/yihu/agent/
â”‚           â”œâ”€â”€ HealthCareApplicationTests.java
â”‚           â””â”€â”€ service/
â”‚               â””â”€â”€ MedicalAssistantServiceTest.java
â”‚
â”œâ”€â”€ frontend/                                 # ç®€å•å‰ç«¯
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ chat.js
â”‚   â””â”€â”€ style.css
â”‚
â”œâ”€â”€ DOC/
â”‚   â””â”€â”€ é¡¹ç›®è®¾è®¡_ç®€åŒ–ç‰ˆ.md (æœ¬æ–‡æ¡£)
â”‚
â””â”€â”€ README.md
```

## ğŸ”§ æ ¸å¿ƒå®ç°æµç¨‹

### **æ¶ˆæ¯æµè½¬æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·é€šè¿‡ WebSocket å‘é€æ¶ˆæ¯                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ChatWebSocketHandler.handleTextMessage()                â”‚
â”‚    - è§£ææ¶ˆæ¯                                                â”‚
â”‚    - è·å– sessionId                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SessionManager.getOrCreateContext(sessionId)             â”‚
â”‚    - ä»å†…å­˜/Redis è·å– SessionContext                        â”‚
â”‚    - åŒ…å«ï¼šå½“å‰çŠ¶æ€ã€PatientInfoã€å¯¹è¯å†å²                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. StateManager.process(context, userMessage)               â”‚
â”‚    - æ ¹æ® context.getCurrentState() é€‰æ‹© Handler            â”‚
â”‚    - è°ƒç”¨å¯¹åº”çš„ Handler.handle()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Handler æ‰§è¡Œï¼ˆä»¥ CollectingHandler ä¸ºä¾‹ï¼‰                â”‚
â”‚    â”œâ”€ è°ƒç”¨ InfoExtractionService.extract(userMessage)      â”‚
â”‚    â”‚  â””â”€ ä½¿ç”¨ LangChain4j AI Service + Tools                â”‚
â”‚    â”‚     æå–ç»“æ„åŒ–ä¿¡æ¯ï¼Œæ›´æ–° PatientInfo                     â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€ æ£€æŸ¥ä¿¡æ¯å®Œæ•´åº¦                                         â”‚
â”‚    â”‚  â””â”€ patientInfo.isReadyForRecommendation()            â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€ å¦‚æœå®Œæ•´ï¼š                                             â”‚
â”‚    â”‚  â””â”€ è½¬æ¢çŠ¶æ€åˆ° RECOMMENDING                            â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€ å¦‚æœä¸å®Œæ•´ï¼š                                           â”‚
â”‚       â””â”€ ä½¿ç”¨ AI ç”Ÿæˆè¿½é—®                                    â”‚
â”‚          â””â”€ aiService.generateQuestion(patientInfo)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ›´æ–° SessionContext                                      â”‚
â”‚    - æ›´æ–°çŠ¶æ€                                                â”‚
â”‚    - ä¿å­˜ PatientInfo                                       â”‚
â”‚    - æ·»åŠ å¯¹è¯å†å²åˆ° ChatMemory                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. è¿”å› StateResponse                                       â”‚
â”‚    - message: AI çš„å›å¤                                     â”‚
â”‚    - state: å½“å‰çŠ¶æ€                                        â”‚
â”‚    - data: é™„åŠ æ•°æ®ï¼ˆå¦‚æ¨èç»“æœï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. WebSocket å‘é€å“åº”ç»™å‰ç«¯                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å…³é”®ä»£ç ç¤ºä¾‹**

#### StateManager.java (æ ¸å¿ƒè°ƒåº¦å™¨)

```java
@Service
@RequiredArgsConstructor
public class StateManager {
    
    private final Map<SessionState, StateHandler> handlers;
    
    @PostConstruct
    public void init() {
        handlers = Map.of(
            SessionState.GREETING, greetingHandler,
            SessionState.COLLECTING, collectingHandler,
            SessionState.RECOMMENDING, recommendHandler,
            SessionState.COMPLETED, completedHandler
        );
    }
    
    public StateResponse process(SessionContext context, String userMessage) {
        SessionState currentState = context.getCurrentState();
        StateHandler handler = handlers.get(currentState);
        
        if (handler == null) {
            throw new IllegalStateException("No handler for state: " + currentState);
        }
        
        return handler.handle(context, userMessage);
    }
}
```

#### CollectingHandler.java (æ ¸å¿ƒå¤„ç†å™¨)

```java
@Service
@RequiredArgsConstructor
public class CollectingHandler implements StateHandler {
    
    private final MedicalAssistantService aiService;
    private final InfoExtractionService extractionService;
    
    @Override
    public StateResponse handle(SessionContext context, String userMessage) {
        // 1. æå–ä¿¡æ¯
        PatientInfo updatedInfo = extractionService.extract(
            context.getPatientInfo(), 
            userMessage
        );
        context.setPatientInfo(updatedInfo);
        
        // 2. æ£€æŸ¥å®Œæ•´åº¦
        if (updatedInfo.isReadyForRecommendation()) {
            // ä¿¡æ¯è¶³å¤Ÿï¼Œè½¬åˆ°æ¨èçŠ¶æ€
            context.setState(SessionState.RECOMMENDING);
            String message = "å¥½çš„ï¼Œæˆ‘å·²ç»äº†è§£äº†æ‚¨çš„æƒ…å†µã€‚æ­£åœ¨ä¸ºæ‚¨æ¨èåˆé€‚çš„åŒ»ç”Ÿ...";
            return StateResponse.builder()
                .message(message)
                .state(SessionState.RECOMMENDING)
                .build();
        } else {
            // ä¿¡æ¯ä¸è¶³ï¼Œç”Ÿæˆè¿½é—®
            String question = aiService.generateFollowUpQuestion(updatedInfo);
            return StateResponse.builder()
                .message(question)
                .state(SessionState.COLLECTING)
                .build();
        }
    }
}
```

## ğŸ“¦ æ ¸å¿ƒä¾èµ– (pom.xml)

```xml
<properties>
    <java.version>17</java.version>
    <spring.boot.version>3.2.0</spring.boot.version>
    <langchain4j.version>0.35.0</langchain4j.version>
</properties>

<dependencies>
    <!-- Spring Boot Core -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- WebSocket -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-websocket</artifactId>
    </dependency>
    
    <!-- LangChain4j Core -->
    <dependency>
        <groupId>dev.langchain4j</groupId>
        <artifactId>langchain4j</artifactId>
        <version>${langchain4j.version}</version>
    </dependency>
    
    <!-- LangChain4j OpenAI Integration -->
    <dependency>
        <groupId>dev.langchain4j</groupId>
        <artifactId>langchain4j-open-ai</artifactId>
        <version>${langchain4j.version}</version>
    </dependency>
    
    <!-- LangChain4j Spring Boot Starter -->
    <dependency>
        <groupId>dev.langchain4j</groupId>
        <artifactId>langchain4j-spring-boot-starter</artifactId>
        <version>${langchain4j.version}</version>
    </dependency>
    
    <!-- Redis (å¯é€‰ï¼Œç”¨äºä¼šè¯æŒä¹…åŒ–) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
    
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
    
    <!-- JSON å¤„ç† -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
    </dependency>
    
    <!-- Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    
    <!-- Test -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

## ğŸ’¡ MVP åŠŸèƒ½æ¸…å•

### **ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å¯¹è¯** (Week 1)
- âœ… WebSocket å®æ—¶å¯¹è¯è¿æ¥
- âœ… ç®€å•çŠ¶æ€ç®¡ç†ï¼ˆGREETING â†’ COLLECTING â†’ RECOMMENDINGï¼‰
- âœ… LangChain4j AI Service é›†æˆ
- âœ… åŸºç¡€å¯¹è¯è®°å¿†ï¼ˆMessageWindowChatMemoryï¼‰
- âœ… ä¿¡æ¯æå–ï¼ˆä»è‡ªç„¶è¯­è¨€ â†’ ç»“æ„åŒ–æ•°æ®ï¼‰

### **ç¬¬äºŒé˜¶æ®µï¼šä¿¡æ¯æ”¶é›†** (Week 2)
- âœ… PatientInfo æ¨¡å‹è®¾è®¡
- âœ… æ™ºèƒ½è¿½é—®é€»è¾‘
- âœ… ä¿¡æ¯å®Œæ•´åº¦åˆ¤æ–­
- âœ… å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ä¿æŒ
- âœ… ä¼šè¯çŠ¶æ€æŒä¹…åŒ–ï¼ˆå†…å­˜ â†’ Redisï¼‰

### **ç¬¬ä¸‰é˜¶æ®µï¼šæ¨èå¼•æ“** (Week 3)
- âœ… ç—‡çŠ¶ â†’ ç§‘å®¤æ˜ å°„
- âœ… åŒ»ç”Ÿæ¨èï¼ˆåŸºäºç§‘å®¤ã€ä¸“é•¿ã€è¯„åˆ†ï¼‰
- âœ… éå¤„æ–¹è¯æ¨è + å…è´£å£°æ˜
- âœ… æ¨èç»“æœæ ¼å¼åŒ–å±•ç¤º
- âœ… ç»“æœåé¦ˆæœºåˆ¶

### **ç¬¬å››é˜¶æ®µï¼šä¼˜åŒ–** (Week 4)
- âœ… å‰ç«¯ç•Œé¢ç¾åŒ–
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… æ—¥å¿—è®°å½•å’Œç›‘æ§
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å•å…ƒæµ‹è¯•

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆç›¸æ¯” LangGraph4jï¼‰

### **ä¸ºä»€ä¹ˆä¸ç”¨ LangGraph4jï¼Ÿ**

1. **ç®€åŒ–å¼€å‘**ï¼šä¸éœ€è¦å­¦ä¹ æ–°çš„çŠ¶æ€æœºæ¡†æ¶
2. **é™ä½å¤æ‚åº¦**ï¼šMVP é˜¶æ®µçŠ¶æ€è½¬æ¢ç®€å•ï¼Œç”¨ if-else å°±å¤Ÿäº†
3. **æ˜“äºè°ƒè¯•**ï¼šçŠ¶æ€æµç¨‹æ¸…æ™°å¯è§ï¼Œå®¹æ˜“æ’æŸ¥é—®é¢˜
4. **çµæ´»æ€§é«˜**ï¼šéšæ—¶å¯ä»¥è°ƒæ•´çŠ¶æ€é€»è¾‘ï¼Œä¸å—æ¡†æ¶é™åˆ¶
5. **ä¾èµ–æ›´å°‘**ï¼šå‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œé™ä½ç»´æŠ¤æˆæœ¬

### **ä½•æ—¶è€ƒè™‘å‡çº§åˆ° LangGraph4jï¼Ÿ**

- çŠ¶æ€æ•°é‡ > 10 ä¸ª
- çŠ¶æ€è½¬æ¢é€»è¾‘éå¸¸å¤æ‚
- éœ€è¦å¹¶è¡Œå¤„ç†å¤šä¸ªçŠ¶æ€
- éœ€è¦å¤æ‚çš„æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯
- éœ€è¦å¯è§†åŒ–çŠ¶æ€æµç¨‹å›¾

## ğŸ”¥ å…³é”®æŠ€æœ¯ç‚¹

### **1. LangChain4j AiServices**

ä½¿ç”¨å£°æ˜å¼æ¥å£å®šä¹‰ AI åŠ©æ‰‹ï¼š

```java
@Service
public interface MedicalAssistant {
    
    @SystemMessage(fromResource = "prompts/info-collection.txt")
    @UserMessage("ç”¨æˆ·è¯´ï¼š{{it}}")
    String chat(String userMessage);
    
    @SystemMessage("æå–æ‚£è€…ä¿¡æ¯ï¼Œè¿”å› JSON æ ¼å¼")
    PatientInfo extractInfo(String conversation);
}

// é…ç½®
MedicalAssistant assistant = AiServices.builder(MedicalAssistant.class)
    .chatLanguageModel(chatModel)
    .chatMemory(chatMemory)
    .tools(new MedicalTools())
    .build();
```

### **2. ChatMemory ç®¡ç†**

```java
@Configuration
public class LangChainConfig {
    
    @Bean
    public ChatMemoryProvider chatMemoryProvider() {
        return sessionId -> MessageWindowChatMemory.builder()
            .maxMessages(20)  // ä¿ç•™æœ€è¿‘ 20 æ¡æ¶ˆæ¯
            .id(sessionId)
            .build();
    }
}
```

### **3. Tools å®šä¹‰**

```java
public class MedicalTools {
    
    @Tool("æ ¹æ®ç—‡çŠ¶æ¨èç§‘å®¤")
    public String recommendDepartment(
        @P("ä¸»è¦ç—‡çŠ¶") String symptom
    ) {
        // å®ç°é€»è¾‘
    }
    
    @Tool("æ£€æŸ¥ä¿¡æ¯æ˜¯å¦å®Œæ•´")
    public boolean isInfoComplete(
        @P("æ‚£è€…ä¿¡æ¯") PatientInfo info
    ) {
        return info.isReadyForRecommendation();
    }
}
```

### **4. WebSocket é…ç½®**

```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(chatWebSocketHandler(), "/ws/chat")
                .setAllowedOrigins("*");
    }
    
    @Bean
    public WebSocketHandler chatWebSocketHandler() {
        return new ChatWebSocketHandler();
    }
}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### **1. åŒ»ç–—åˆè§„æ€§**
- âŒ **ä¸èƒ½**ï¼šè¯Šæ–­ç–¾ç—…ã€å¼€å…·å¤„æ–¹è¯
- âœ… **å¯ä»¥**ï¼šæ”¶é›†ç—‡çŠ¶ã€æ¨èç§‘å®¤ã€æ¨è OTC è¯ç‰©
- ğŸ”´ **å¿…é¡»**ï¼šåœ¨æ¯æ¬¡æ¨èåæ·»åŠ å…è´£å£°æ˜

### **2. æ•°æ®éšç§**
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹
- å®šæœŸæ¸…ç†è¿‡æœŸä¼šè¯æ•°æ®
- ä¸å¾—æ³„éœ²ç”¨æˆ·å¥åº·ä¿¡æ¯

### **3. æ€§èƒ½ä¼˜åŒ–**
- WebSocket è¿æ¥æ± ç®¡ç†
- ä¼šè¯è¶…æ—¶è‡ªåŠ¨æ¸…ç†ï¼ˆ30åˆ†é’Ÿæ— æ´»åŠ¨ï¼‰
- LLM è°ƒç”¨è¶…æ—¶è®¾ç½®ï¼ˆ30ç§’ï¼‰
- ä½¿ç”¨æµå¼å“åº”ï¼ˆStreamingï¼‰æå‡ä½“éªŒ

### **4. é”™è¯¯å¤„ç†**
- LLM è°ƒç”¨å¤±è´¥çš„é™çº§ç­–ç•¥
- WebSocket æ–­çº¿é‡è¿
- å¼‚å¸¸ä¿¡æ¯ç”¨æˆ·å‹å¥½åŒ–

## ğŸ“Š æ•°æ®å‡†å¤‡

### **doctors.json ç¤ºä¾‹**

```json
[
  {
    "id": "D001",
    "name": "å¼ åŒ»ç”Ÿ",
    "department": "å†…ç§‘",
    "specialty": "å‘¼å¸ç³»ç»Ÿç–¾ç—…",
    "title": "ä¸»ä»»åŒ»å¸ˆ",
    "rating": 4.8,
    "experience": 15,
    "hospital": "å¸‚ç¬¬ä¸€äººæ°‘åŒ»é™¢"
  },
  {
    "id": "D002",
    "name": "æåŒ»ç”Ÿ",
    "department": "ç¥ç»å†…ç§‘",
    "specialty": "å¤´ç—›ã€å¤´æ™•",
    "title": "å‰¯ä¸»ä»»åŒ»å¸ˆ",
    "rating": 4.6,
    "experience": 10,
    "hospital": "å¸‚ä¸­åŒ»é™¢"
  }
]
```

### **medicines.json ç¤ºä¾‹**

```json
[
  {
    "id": "M001",
    "name": "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š",
    "category": "è§£çƒ­é•‡ç—›è¯",
    "symptoms": ["å¤´ç—›", "å‘çƒ­", "ç‰™ç—›"],
    "dosage": "æˆäººä¸€æ¬¡1ç²’ï¼Œä¸€æ—¥2æ¬¡",
    "contraindications": "å­•å¦‡ã€å“ºä¹³æœŸå¦‡å¥³ç¦ç”¨",
    "sideEffects": "å¯èƒ½å¼•èµ·èƒƒè‚ ä¸é€‚",
    "price": 12.5
  }
]
```

### **symptom-department-mapping.json**

```json
{
  "å¤´ç—›": ["ç¥ç»å†…ç§‘", "ç–¼ç—›ç§‘"],
  "å‘çƒ§": ["å†…ç§‘", "æ€¥è¯Šç§‘"],
  "å’³å—½": ["å‘¼å¸ç§‘", "å†…ç§‘"],
  "èƒƒç—›": ["æ¶ˆåŒ–å†…ç§‘", "æ™®å¤–ç§‘"],
  "èƒ¸ç—›": ["å¿ƒå†…ç§‘", "å‘¼å¸ç§‘", "æ€¥è¯Šç§‘"],
  "çš®ç–¹": ["çš®è‚¤ç§‘", "è¿‡æ•ç§‘"]
}
```

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**æˆ‘å¯ä»¥ç«‹å³å¸®æ‚¨ï¼š**

1. âœ… **ç”Ÿæˆå®Œæ•´é¡¹ç›®ä»£ç ** - æ‰€æœ‰ Java ç±»ã€é…ç½®æ–‡ä»¶ã€å‰ç«¯ä»£ç 
2. âœ… **é…ç½® LangChain4j** - application.yml + LangChainConfig
3. âœ… **å®ç°æ ¸å¿ƒçŠ¶æ€ç®¡ç†** - StateManager + Handlers
4. âœ… **WebSocket é€šä¿¡** - å®Œæ•´çš„å®æ—¶å¯¹è¯åŠŸèƒ½
5. âœ… **å‡†å¤‡æµ‹è¯•æ•°æ®** - doctors.json + medicines.json
6. âœ… **åˆ›å»ºç®€å•å‰ç«¯** - HTML + JS èŠå¤©ç•Œé¢

---

## ğŸ“ æ€»ç»“

æœ¬è®¾è®¡é‡‡ç”¨ **LangChain4j + ç®€å•çŠ¶æ€æ¨¡å¼ + WebSocket** çš„æ¶æ„ï¼š

- ğŸ¯ **æ ¸å¿ƒæ€è·¯**ï¼šä¸ä½¿ç”¨å¤æ‚çš„çŠ¶æ€æœºæ¡†æ¶ï¼Œç”¨ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨ + å¤„ç†å™¨æ¨¡å¼
- ğŸš€ **å¿«é€Ÿå¼€å‘**ï¼šå‡å°‘å­¦ä¹ æˆæœ¬ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- ğŸ”§ **æ˜“äºç»´æŠ¤**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ç®€å•
- ğŸ“ˆ **å¯æ‰©å±•**ï¼šåæœŸå¯æ ¹æ®éœ€è¦å‡çº§åˆ° LangGraph4j

**é€‚åˆ MVP å¿«é€ŸéªŒè¯ï¼Œ2-3 å‘¨å³å¯å®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼**

